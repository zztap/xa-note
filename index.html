<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />

  <!-- åŸºç¡€SEO -->
  <title>Loading...</title>
  <meta name="description"
    content="XA Noteæ˜¯ä¸€æ¬¾ç°ä»£åŒ–çš„æ™ºèƒ½ç¬”è®°ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒMarkdownç¼–è¾‘ã€åˆ†ç±»ç®¡ç†ã€æ ‡ç­¾ç³»ç»Ÿã€å…¨æ–‡æœç´¢ã€WebDAVå¤‡ä»½ç­‰åŠŸèƒ½ã€‚æä¾›ç®€æ´ä¼˜é›…çš„ç•Œé¢ï¼ŒåŠ©æ‚¨é«˜æ•ˆè®°å½•å’Œç®¡ç†çŸ¥è¯†ã€‚" />
  <meta name="keywords" content="ç¬”è®°ç®¡ç†,Markdownç¼–è¾‘å™¨,çŸ¥è¯†ç®¡ç†,ç¬”è®°è½¯ä»¶,åœ¨çº¿ç¬”è®°,äº‘ç¬”è®°,WebDAVå¤‡ä»½,å…¨æ–‡æœç´¢,æ ‡ç­¾ç®¡ç†,åˆ†ç±»æ•´ç†" />
  <meta name="author" content="XA Note Team" />
  <meta name="robots" content="index, follow" />
  <meta name="language" content="zh-CN" />

  <!-- è§†å£å’Œç§»åŠ¨ç«¯ä¼˜åŒ– -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="XA Note" />

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="/" />
  <meta property="og:title" content="XA Note - æ™ºèƒ½ç¬”è®°ç®¡ç†ç³»ç»Ÿ" />
  <meta property="og:description" content="ç°ä»£åŒ–çš„æ™ºèƒ½ç¬”è®°ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒMarkdownç¼–è¾‘ã€åˆ†ç±»ç®¡ç†ã€æ ‡ç­¾ç³»ç»Ÿã€å…¨æ–‡æœç´¢ç­‰åŠŸèƒ½ã€‚" />
  <meta property="og:image" content="//og-image.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:site_name" content="XA Note" />
  <meta property="og:locale" content="zh_CN" />

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image" />
  <meta property="twitter:url" content="/" />
  <meta property="twitter:title" content="XA Note - æ™ºèƒ½ç¬”è®°ç®¡ç†ç³»ç»Ÿ" />
  <meta property="twitter:description" content="ç°ä»£åŒ–çš„æ™ºèƒ½ç¬”è®°ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒMarkdownç¼–è¾‘ã€åˆ†ç±»ç®¡ç†ã€æ ‡ç­¾ç³»ç»Ÿã€å…¨æ–‡æœç´¢ç­‰åŠŸèƒ½ã€‚" />
  <meta property="twitter:image" content="//twitter-image.png" />
  <meta property="twitter:creator" content="@xa_note" />

  <!-- å›¾æ ‡å’Œä¸»é¢˜ -->
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="manifest" href="/manifest.json" />
  <meta name="theme-color" content="#3b82f6" />
  <meta name="msapplication-TileColor" content="#3b82f6" />
  <meta name="msapplication-config" content="/browserconfig.xml" />

  <!-- é¢„è¿æ¥å’ŒDNSé¢„è§£æ -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="dns-prefetch" href="//api.github.com" />
  <!-- å¤´åƒæºé¢„å‘åŠ› -->
  <link rel="preconnect" href="https://cravatar.cn" />
  <link rel="dns-prefetch" href="https://cravatar.cn" />

  <!-- æ ¸å¿ƒèµ„æºæé€Ÿé¢„åŠ è½½ -->
  <link rel="preload" href="/assets/index-CfJzE6qT.js" as="script" crossorigin="anonymous" />
  <link rel="preload" href="/assets/index-Czj62kEc.css" as="style" crossorigin />
  <link rel="preload" href="/beautify.css" as="style" />

  <!-- ç»“æ„åŒ–æ•°æ® -->
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "XA Note",
      "description": "è½»é‡çº§è‡ªæ‰˜ç®¡ç¬”è®°ç³»ç»Ÿï¼Œæ”¯æŒMarkdownç¼–è¾‘ã€åˆ†ç±»ç®¡ç†ã€æ ‡ç­¾ç³»ç»Ÿã€å…¨æ–‡æœç´¢ã€ç¬”è®°åˆ†äº«ã€WebDAVå¤‡ä»½ç­‰åŠŸèƒ½",
      "url": "//",
      "applicationCategory": "ProductivityApplication",
      "operatingSystem": "Web Browser",
      "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
      },
      "author": {
            "@type": "Organization",
            "name": "XiaoA"
      },
      "softwareVersion": "1.0.0",
      "datePublished": "2026-01-15",
      "screenshot": "//screenshot.png",
      "featureList": [
            "Markdownç¼–è¾‘å™¨",
            "åˆ†ç±»ç®¡ç†",
            "æ ‡ç­¾ç³»ç»Ÿ",
            "å…¨æ–‡æœç´¢",
            "WebDAVå¤‡ä»½",
            "å¤šè¯­è¨€æ”¯æŒ",
            "æš—é»‘æ¨¡å¼",
            "å“åº”å¼è®¾è®¡"
      ]
}
    </script>

  <!-- å®‰å…¨å’Œéšç§ -->
  <meta http-equiv="X-Content-Type-Options" content="nosniff" />
  <meta http-equiv="X-XSS-Protection" content="1; mode=block" />
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin" />

  <!-- XA Note Share Page Handler -->
  <!-- MUST be before the React module script to prevent React from loading on share pages -->
  <script src="/share-handler.js?v=3"></script>

  <script type="module" crossorigin src="/assets/index-CfJzE6qT.js"></script>
  <!-- Premium UI Enhancement -->
  <link rel="stylesheet" crossorigin href="/assets/index-Czj62kEc.css">
  <link rel="stylesheet" href="/beautify.css">
</head>

<body>
  <!-- Splash Screen -->
  <div id="loader-wrapper">
    <div id="loader">
      <div class="loader-logo">
        <svg viewBox="0 0 100 100" width="80" height="80">
          <defs>
            <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#1d4ed8;stop-opacity:1" />
            </linearGradient>
          </defs>
          <path d="M20 20 L80 20 L80 80 L20 80 Z" fill="none" stroke="url(#grad1)" stroke-width="8"
            stroke-linejoin="round" />
          <path d="M35 40 L65 40 M35 50 L65 50 M35 60 L50 60" stroke="#3b82f6" stroke-width="6"
            stroke-linecap="round" />
        </svg>
      </div>
      <div class="loader-text">XA Note</div>
      <div class="loader-progress">
        <div class="loader-progress-bar"></div>
      </div>
    </div>
  </div>

  <div id="root"></div>

  <script>
    /**
     * XA Note æé€Ÿå¯åŠ¨æˆªæµå™¨ (Fetch Deduplicator & Turbo Prefetch)
     * 1. è‡ªåŠ¨åˆå¹¶å†—ä½™çš„ /api/shares è¯·æ±‚
     * 2. å¯¹å…³é”®è·¯å¾„ APIï¼ˆè®¾ç½®ã€ç¬”è®°ã€åˆ†ç±»ï¼‰æ‰§è¡Œå¹¶è¡ŒæŠ¢è·‘ï¼Œæ¶ˆé™¤ç€‘å¸ƒæµå»¶è¿Ÿ
     */
    (function () {
      const originalFetch = window.fetch;
      const memo = new Map();

      // å®šä¹‰éœ€è¦æŠ¢è·‘çš„â€œé»„é‡‘â€æ¥å£
      const turboEndpoints = [
        '/api/settings/public',
        '/api/notes',
        '/api/categories',
        '/api/settings' // é’ˆå¯¹å·²ç™»å½•ç”¨æˆ·çš„å®Œæ•´è®¾ç½®
      ];

      // ç«‹å³æŠ¢è·‘ï¼šåœ¨ JS å¼•æ“ç©ºé—²çš„ç¬¬ä¸€æ—¶é—´å‘èµ·è¯·æ±‚
      turboEndpoints.forEach(url => {
        memo.set(url, originalFetch(url).catch(e => {
          memo.delete(url); // å¤±è´¥åˆ™ç§»é™¤ï¼Œå…è®¸ React ç¨åé‡è¯•
          throw e;
        }));
      });

      window.fetch = function (...args) {
        let url = typeof args[0] === 'string' ? args[0] : args[0].url;

        // è§„èŒƒåŒ– URL (å¤„ç†ç›¸å¯¹è·¯å¾„å’Œå‰ç¼€)
        if (url.startsWith('/api')) {
          const pureUrl = url.split('?')[0];

          // åœºæ™¯ A: å‘½ä¸­äº†æŠ¢è·‘é€»è¾‘çš„é»„é‡‘æ¥å£
          if (turboEndpoints.includes(pureUrl) && (!args[1] || args[1].method === 'GET' || !args[1].method)) {
            // æ³¨æ„ï¼š/api/notes ç­‰å¸¦å‚æ•°çš„è¯·æ±‚ä¸ç›´æ¥å¤ç”¨æ— å‚æ•°æŠ¢è·‘ç»“æœï¼Œé™¤éç²¾ç¡®åŒ¹é…
            if (memo.has(url)) {
              return memo.get(url).then(res => res.clone());
            }
          }

          // åœºæ™¯ B: é’ˆå¯¹ /api/shares?note_id=... çš„å»é‡åˆå¹¶
          if (url.includes('/api/shares?note_id=') && (!args[1] || args[1].method === 'GET' || !args[1].method)) {
            if (memo.has(url)) {
              return memo.get(url).then(res => res.clone());
            }

            const promise = originalFetch.apply(this, args).then(response => {
              setTimeout(() => memo.delete(url), 100);
              return response;
            }).catch(err => {
              memo.delete(url);
              throw err;
            });
            memo.set(url, promise);
            return promise.then(res => res.clone());
          }
        }

        return originalFetch.apply(this, args);
      };
    })();

    // å“åº”å¼éšè—å¯åŠ¨é¡µ (æ£€æµ‹ç›®æ ‡ï¼š#root æŒ‚è½½å†…å®¹)
    const splashObserver = new MutationObserver(() => {
      const root = document.getElementById('root');
      const wrapper = document.getElementById('loader-wrapper');
      if (root && root.children.length > 0 && wrapper) {
        wrapper.classList.add('loaded');
        setTimeout(() => wrapper.remove(), 800);
        splashObserver.disconnect();
      }
    });
    splashObserver.observe(document.getElementById('root'), { childList: true });

    // å¤‡ç”¨æ–¹æ¡ˆï¼šé˜²æ­¢ç”±äºå¼‚å¸¸å¯¼è‡´æ°¸ä¹…ç™½å± (3.5s å¼ºåˆ¶å…³é—­)
    window.addEventListener('load', () => {
      setTimeout(() => {
        const wrapper = document.getElementById('loader-wrapper');
        if (wrapper && !wrapper.classList.contains('loaded')) {
          wrapper.classList.add('loaded');
          setTimeout(() => wrapper.remove(), 800);
          splashObserver.disconnect();
        }
      }, 3500);
    });

    // æ—¥å¿—ç®¡ç†èƒ½åŠ›ä¿®å¤è„šæœ¬ (æ³¨å…¥ UI æŒ‰é’®)
    (function () {
      function injectLogDeleteButton() {
        // å®šä½æ—¥å¿—å¼¹çª—
        const modal = Array.from(document.querySelectorAll('div')).find(el =>
          el.classList.contains('fixed') && el.textContent.includes('æ—¥å¿—') && el.querySelector('.fa-xmark, svg')
        );
        if (!modal) return;

        // å®šä½é‡ç½®æŒ‰é’®
        const buttons = Array.from(modal.querySelectorAll('button'));
        const resetButton = buttons.find(b => b.textContent.trim() === 'é‡ç½®');
        if (!resetButton || modal.querySelector('.custom-clear-logs-btn')) return;

        const clearBtn = document.createElement('button');
        clearBtn.className = 'custom-clear-logs-btn bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600 transition-all flex items-center justify-center';
        clearBtn.style.cssText = 'margin-left: 10px; background-color: #ef4444; color: white; padding: 6px 16px; border-radius: 6px; font-weight: 500; font-size: 14px;';
        clearBtn.textContent = 'æ¸…ç©ºå…¨éƒ¨æ—¥å¿—';

        clearBtn.onclick = async (e) => {
          e.preventDefault();
          if (confirm('âš ï¸ ç¡®å®šè¦å½»åº•æ¸…ç©ºæ‰€æœ‰æ“ä½œæ—¥å¿—å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚')) {
            clearBtn.disabled = true;
            clearBtn.textContent = 'æ¸…ç†ä¸­...';
            try {
              const res = await fetch('/api/logs/cleanup', {
                method: 'DELETE',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ days: 0 })
              });
              const data = await res.json();
              if (data.ok) {
                alert('Success: æ—¥å¿—å·²æˆåŠŸæ¸…ç©º');
                location.reload();
              } else {
                alert('Error: ' + (data.error || 'æ¸…ç†å¤±è´¥'));
              }
            } catch (err) {
              alert('Network Error: æ— æ³•è¿æ¥è‡³æœåŠ¡å™¨');
            } finally {
              clearBtn.disabled = false;
              clearBtn.textContent = 'æ¸…ç©ºå…¨éƒ¨æ—¥å¿—';
            }
          }
        };

        resetButton.parentNode.appendChild(clearBtn);
      }

      // æŒç»­ç›‘å¬ DOM å˜åŠ¨ï¼Œç¡®ä¿å¼¹çª—è½½å…¥æ—¶èƒ½æ³¨å…¥
      const observer = new MutationObserver((mutations) => {
        for (const mutation of mutations) {
          if (mutation.addedNodes.length) injectLogDeleteButton();
        }
      });
      observer.observe(document.body, { childList: true, subtree: true });
    })();

    // å¿«æ·é”®é€»è¾‘ä¿®å¤ä¸è¡Œä¸ºæ‹¦æˆª (é˜²æ­¢ Ctrl + K åˆ·æ–°é¡µé¢)
    window.addEventListener('keydown', (e) => {
      // æ‹¦æˆª Ctrl + K æˆ– Cmd + K
      if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'k') {
        e.preventDefault(); // å¼ºè¡Œæ‹¦æˆªé»˜è®¤è¡Œä¸º

        // å°è¯•è‡ªåŠ¨èšç„¦æœç´¢æ¡†
        const searchInput = document.querySelector('input[placeholder*="æœç´¢"]');
        if (searchInput) {
          searchInput.focus();
          // å¦‚æœä¸åœ¨ä¾§è¾¹æ è§†å£ï¼Œå¯ä»¥å°è¯•å±•å¼€ä¾§è¾¹æ ï¼ˆå¦‚æœåŸç¨‹åºæ”¯æŒï¼‰
        } else {
          // å¦‚æœå¼¹çª—æ²¡å¼€ï¼Œå¯ä»¥æ¨¡æ‹Ÿç‚¹å‡»æœç´¢å›¾æ ‡æˆ–æŒ‰é’®ï¼ˆå¦‚æœèƒ½å®šä½åˆ°ï¼‰
          console.log('Search shortcut intercepted, but input not found.');
        }
      }

      // é¢å¤–ä¿é™©ï¼šæ‹¦æˆª Ctrl + S ä»¥é˜²æ­¢è§¦å‘ç³»ç»Ÿä¿å­˜å¼¹çª—
      if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 's') {
        // é€šå¸¸åŸç¨‹åºæœ‰å¤„ç†ï¼Œè¿™é‡Œä¸»è¦æ˜¯äºŒæ¬¡ä¿é™©ï¼Œä¸å¼ºåˆ¶ preventDefault é™¤éç¡®å®šå†²çª
      }
    }, true); // ä½¿ç”¨æ•è·é˜¶æ®µä»¥è·å¾—æœ€é«˜ä¼˜å…ˆæƒ



    // ç¬”è®°å¡ç‰‡å½©è‰²åŒ–è„šæœ¬ (Stable & Neighbor-Aware Pastel Colors)
    (function () {
      function getHash(str) {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
          hash = ((hash << 5) - hash) + str.charCodeAt(i);
          hash |= 0;
        }
        return Math.abs(hash);
      }

      function applyStableColors() {
        const cards = Array.from(document.querySelectorAll('.note-item, .note-list-item'));
        let lastVariant = -1;

        cards.forEach((card) => {
          // è·å–ç°æœ‰å˜ä½“ç±»å
          const currentVariantClass = Array.from(card.classList).find(c => c.startsWith('note-variant-'));

          // è·å–æ ¸å¿ƒå†…å®¹ + å„ç§æ‰°åŠ¨ç‰¹å¾ (é•¿åº¦ã€æ—¥æœŸç­‰)ï¼Œä½¿ç›¸ä¼¼å†…å®¹å°½é‡åˆ†è‰²
          const content = card.innerText || card.textContent || '';
          const salt = content.length + (card.querySelector('.text-xs')?.textContent?.length || 0);
          const hash = getHash(content.substring(0, 100) + salt);

          let variant = (hash % 6) + 1;

          // é‚»ä½å·®å¼‚åŒ–é€»è¾‘ï¼šå¦‚æœè·Ÿä¸Šé¢ä¸€å¼ å¡ç‰‡æ’è‰²äº†ï¼Œåˆ™å¾ªç¯ä½ç§»
          if (variant === lastVariant) {
            variant = (variant % 6) + 1;
          }

          // å¦‚æœæ–°è®¡ç®—çš„é¢œè‰²ä¸å½“å‰ä¸åŒï¼Œæˆ–è€…æ²¡æœ‰é¢œè‰²ï¼Œåˆ™æ›´æ–°
          const newVariantClass = `note-variant-${variant}`;
          if (currentVariantClass !== newVariantClass) {
            if (currentVariantClass) card.classList.remove(currentVariantClass);
            card.classList.add(newVariantClass);
          }

          lastVariant = variant;
        });
      }

      // ç›‘è§†ï¼šç›‘æµ‹å­èŠ‚ç‚¹å˜åŒ–å’Œç±»åå˜åŒ–
      const colorObserver = new MutationObserver(() => applyStableColors());
      colorObserver.observe(document.body, {
        childList: true,
        subtree: true,
        attributes: true,
        attributeFilter: ['class']
      });

      applyStableColors();
      setInterval(applyStableColors, 1500);
    })();

    // å¼ºåŠ›å¤´åƒé˜²è£‚è¡¥ä¸ (Avatar Auto-Fallback)
    // ç›‘å¬å…¨å±€å›¾ç‰‡åŠ è½½é”™è¯¯ï¼Œè‡ªåŠ¨æ›¿æ¢ä¸ºæœ¬åœ° Logo
    window.addEventListener('error', (e) => {
      const target = e.target;
      if (target && target.tagName === 'IMG') {
        const src = target.src || '';
        // ä»…é’ˆå¯¹å¤´åƒç›¸å…³çš„å›¾ç‰‡è¿›è¡Œå¤„ç†
        if (src.includes('gravatar.com') || src.includes('cravatar.cn') || target.alt?.toLowerCase().includes('avatar')) {
          // é˜²æ­¢æ­»å¾ªç¯
          if (src.includes('/logo.png')) return;

          console.warn('Avatar load failed, falling back to local logo.', src);
          target.removeAttribute('srcset'); // æ¸…é™¤å“åº”å¼æº
          target.src = '/logo.png';
          target.onerror = null; // æ¸…é™¤å†…è”é”™è¯¯å¤„ç†
          target.style.backgroundColor = '#f0f9ff'; // å¢åŠ æ·¡è“èƒŒæ™¯
        }
      }
    }, true); // å¿…é¡»å¼€å¯æ•è·(capture)æ‰èƒ½ç›‘å¬åˆ° error äº‹ä»¶

    // â˜¢ï¸ æ ¸å¼¹çº§åŸŸåé‡å†™ (Aggressive Avatar URL Rewriter)
    // ä¸ç®¡åç«¯æˆ–å‰ç«¯å­˜äº†ä»€ä¹ˆï¼Œåªè¦ DOM é‡Œå‡ºç° gravatar.comï¼Œå¼ºåˆ¶æ›¿æ¢ä¸º cravatar.cn
    (function aggressiveAvatarRedirect() {
      const replaceSrc = (img) => {
        if (img.src && img.src.includes('gravatar.com')) {
          // ä¿ç•™ hash å’Œå‚æ•°ï¼Œåªæ›¿æ¢åŸŸå
          const newSrc = img.src.replace('gravatar.com', 'cravatar.cn');
          img.src = newSrc;
          // æ ‡è®°å·²å¤„ç†ï¼Œé˜²æ­¢åå¤è§¦å‘ï¼ˆè™½ç„¶ src å˜äº†è‡ªç„¶ä¸å†åŒ…å« gravatarï¼‰
          img.dataset.fixed = 'true';
        }
      };

      // 1. æ‰«æç°æœ‰å›¾ç‰‡
      document.querySelectorAll('img').forEach(replaceSrc);

      // 2. åŠå…¶éœ¸é“åœ°ç›‘å¬æ‰€æœ‰æ–°å›¾ç‰‡
      new MutationObserver((mutations) => {
        mutations.forEach(m => {
          m.addedNodes.forEach(node => {
            if (node.nodeName === 'IMG') replaceSrc(node);
            if (node.querySelectorAll) node.querySelectorAll('img').forEach(replaceSrc);
          });
          // åŒæ—¶ä¹Ÿç›‘å¬å±æ€§å˜åŒ– (å¦‚ React é‡æ–°æ¸²æŸ“å¯¼è‡´ src å˜åŒ–)
          if (m.type === 'attributes' && m.target.nodeName === 'IMG') {
            replaceSrc(m.target);
          }
        });
      }).observe(document.body, {
        childList: true,
        subtree: true,
        attributes: true,
        attributeFilter: ['src']
      });
    })();

    // ğŸš€ ç¬”è®°é¢„è§ˆè„±æ•æ‹¦æˆªå™¨ (Note Preview Sanitizer) [B3]
    // è‡ªåŠ¨å‰¥ç¦»åˆ—è¡¨æ‘˜è¦ä¸­æ®‹å­˜çš„ HTML æ ‡ç­¾ï¼Œä¿æŒä¾§è¾¹æ çº¯å‡€
    (function () {
      const sanitize = (el) => {
        // å¦‚æœå·²ç»å¤„ç†è¿‡ï¼Œæˆ–è€…æ²¡æœ‰å†…å®¹ï¼Œåˆ™è·³è¿‡
        if (el.dataset.sanitized === 'true') return;
        const raw = el.textContent || "";
        // æ ¸å¿ƒæ£€æµ‹ï¼šå¦‚æœåŒ…å« HTML ç‰¹å¾ç¬¦å·ï¼Œåˆ™æ‰§è¡Œæ¸…æ´—
        if (raw.includes('<') || raw.includes('>')) {
          // ä½¿ç”¨æ­£åˆ™å‰¥ç¦»æ‰€æœ‰æ ‡ç­¾ï¼Œå¹¶å°†å¤šä¸ªç©ºæ ¼åˆå¹¶
          const clean = raw.replace(/<\/?[^>]+(>|$)/g, "").replace(/\s+/g, " ").trim();
          el.textContent = clean;
          el.dataset.sanitized = 'true';
        }
      };

      // ä½¿ç”¨ MutationObserver ç›‘å¬åˆ—è¡¨å˜åŠ¨ (å¤„ç† React åŠ¨æ€æ¸²æŸ“)
      const observer = new MutationObserver((mutations) => {
        mutations.forEach(m => {
          m.addedNodes.forEach(node => {
            if (node.nodeType === 1) {
              // åŒ¹é…ä¾§è¾¹æ ç¬”è®°æ‘˜è¦çš„ç‰¹å®šçš„ P æ ‡ç­¾æ ·å¼
              if (node.matches && node.matches('.note-item p')) sanitize(node);
              node.querySelectorAll?.('.note-item p').forEach(sanitize);
            }
          });
        });
      });

      observer.observe(document.body, { childList: true, subtree: true });

      // å®šæœŸä¿åº•æ‰«æ (åº”å¯¹æŸäº›å¤æ‚çš„ React çŠ¶æ€é‡ç½®)
      setInterval(() => {
        document.querySelectorAll('.note-item p').forEach(sanitize);
      }, 2000);
    })();

    // å¤´åƒæºè‡ªåŠ¨è¿ç§»è„šæœ¬ (Auto-Migrate to GitHub Static Avatar)
    (async function migrateAvatarSource() {
      const GITHUB_AVATAR = 'https://raw.githubusercontent.com/zztap/xa-note/main/avatar.png#';
      try {
        // å…ˆæ£€æŸ¥æ˜¯å¦å·²ç™»å½• (POST /api/settings éœ€è¦è®¤è¯)
        const authCheck = await fetch('/api/settings');
        if (!authCheck.ok) return;

        const settings = await authCheck.json();
        const currentPrefix = settings['site.avatar_prefix'];

        if (currentPrefix && !currentPrefix.includes('githubusercontent.com')) {
          console.log('ğŸ“¦ æ­£åœ¨å°†æ•°æ®åº“å¤´åƒæºä¿®æ­£ä¸º GitHub...');
          await fetch('/api/settings', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 'site.avatar_prefix': GITHUB_AVATAR })
          });
        }
      } catch (e) {
        console.warn('Avatar migration check skipped:', e);
      }
    })();

  </script>
</body>

</html>